import { useState } from "react";
import { Card, CardContent } from "@/components/ui/card";
import { Button } from "@/components/ui/button";
import { Input } from "@/components/ui/input";

export default function SlushCalculator() {
  const [ingredients, setIngredients] = useState([
    { name: "", amount: "", sugar: "", alcohol: "" },
  ]);

  const addIngredient = () => {
    setIngredients([...ingredients, { name: "", amount: "", sugar: "", alcohol: "" }]);
  };

  const updateIngredient = (index, field, value) => {
    const newIngredients = [...ingredients];
    newIngredients[index][field] = value;
    setIngredients(newIngredients);
  };

  const calculateTotals = () => {
    let totalAmount = 0, totalSugar = 0, totalAlcohol = 0;
    ingredients.forEach(({ amount, sugar, alcohol }) => {
      const amt = parseFloat(amount) || 0;
      totalAmount += amt;
      totalSugar += (parseFloat(sugar) || 0) * amt / 100; // Umrechnung von g/100ml in Prozent
      totalAlcohol += (parseFloat(alcohol) || 0) * amt;
    });
    return {
      totalSugar: totalAmount ? (totalSugar / totalAmount) * 100 : 0,
      totalAlcohol: totalAmount ? (totalAlcohol / totalAmount) : 0,
      isValid: totalAmount && (totalSugar / totalAmount) * 100 >= 5 && (totalAlcohol / totalAmount) < 16,
      totalAmount
    };
  };

  const { totalSugar, totalAlcohol, isValid, totalAmount } = calculateTotals();
  const isAmountValid = totalAmount >= 475 && totalAmount <= 1890;

  return (
    <div className="p-4">
      <h1 className="text-xl font-bold mb-4">Slush Kalkulator</h1>
      {ingredients.map((ingredient, index) => (
        <Card key={index} className="mb-2 p-2">
          <CardContent className="grid grid-cols-4 gap-2">
            <Input placeholder="Zutat" value={ingredient.name} onChange={(e) => updateIngredient(index, "name", e.target.value)} />
            <Input placeholder="Menge (ml)" type="number" value={ingredient.amount} onChange={(e) => updateIngredient(index, "amount", e.target.value)} />
            <Input placeholder="Zucker (g/100ml)" type="number" value={ingredient.sugar} onChange={(e) => updateIngredient(index, "sugar", e.target.value)} />
            <Input placeholder="Alkohol (%)" type="number" value={ingredient.alcohol} onChange={(e) => updateIngredient(index, "alcohol", e.target.value)} />
          </CardContent>
        </Card>
      ))}
      <Button onClick={addIngredient} className="mb-4">Zutat hinzufügen</Button>
      <Card className="p-2">
        <CardContent>
          <p><strong>Gesamte Menge:</strong> {totalAmount} ml</p>
          <p><strong>Gesamter Zuckeranteil:</strong> {totalSugar.toFixed(2)}%</p>
          <p><strong>Gesamter Alkoholgehalt:</strong> {totalAlcohol.toFixed(2)}%</p>
          <p><strong>Slush geeignet?</strong> {isValid ? "Ja" : "Nein"}</p>
          <p><strong>Füllmenge korrekt?</strong> {isAmountValid ? "Ja" : "Nein (Muss zwischen 475ml und 1890ml sein)"}</p>
        </CardContent>
      </Card>
    </div>
  );
}
